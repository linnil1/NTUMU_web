<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="js/jquery-3.1.0.min.js"></script>
	<script src="js/vue.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="css/bootstrap.css"></link>
	<link rel="stylesheet" href="css/markdown.css"></link>
	<link rel="stylesheet" href="css/mynavbar.css"></link>
	<title class="title-word">title</title>
</head>
<body>
	<div id="LOGO" class="logo">
		<img src="img/permanent_logo.png" height="100" alt="LOGO">
		<h1>台大武術聯盟      </h1> 
		<h2>NTU Martial Union </h2>			
	</div>

	<nav class="navbar navbar-default" id="navbar" v-bind:class="navbar_fix">
		<div class="container-fluid">
			<div class="navbar-header">
				<button id="sidebar_collapse_btn" class="navbar-toggle collapsed" d data-toggle="collapse" data-target="#sidebar_id" v-if="clubhtml">導覽</button>
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-collapse" aria-expanded="false">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a href="#" v-on:click="urlGo('')">
					<img src="img/105_1_logo.png"  height="50" alt="logo">
				</a>
				<h3 class="navbar-text mobile-hide title-word">title</h3>
			</div>
			<div class="collapse navbar-collapse" id="nav-collapse">
				<ul class="nav navbar-nav"  >
					<li v-for="nav in nav_bar">
						<a href="#" v-on:click="urlGo(nav.url)">{{nav.name}}</a>
					</li>
					<li class="dropdown">
						<a href="#" v-on:click="urlGo('app=card')" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="100" data-close-others="false">
							{{club}}<b class="caret"></b>
						</a>
						<ul class="dropdown-menu grid">
							<li v-for="club in clubs">
								<a href="#" v-on:click="urlGo(club.url)">{{club.name}}</a>
							</li>
							<!-- <li class="divider"></li>-->
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!--navbar end-->

	<div id="boothmap">
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlggHYFZpq69QFa2_F1vE4Clt5bYmAtLA" ></script>

		<style>
#boothmap{
	height: 80vh;
	width: 95vw;
	margin: auto;
}
#gmap {
	height: 100%;
}
#gmap p,#gmap h3{
	padding: 5px;
	margin: 0;
}
		</style>
		<div id="gmap"></div>
	</div>
	
	<footer class="footer">
      <div class="container">
        <p >Author : linnil1 (楊氏廣法太極拳社)</p>
        <p >Email : linnil1.886@gmail.com</p>
		<p >Tool : <a href="http://vuejs.org/" target="_blank">Vuejs</a>,
				   <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a> 
		</p>
      </div>
    </footer>

</body>

	<script> 
var jsondata = {},
	ts = "105_1";

var urlGo = function(text){
	console.log("go to "+window.location.href)
}

var map = new Vue({
	el: "#boothmap",
	data: { 
		map:null
	},
	created: function(){
		$(".title-word").html("武聯-攤位地圖")
	}
	ready: function(){
        this.map = new google.maps.Map(document.getElementById('gmap'), {
          center: {lat: 25.0171052, lng: 121.5368509},
          zoom: 19
        });

		var self = this.$data
	$.getJSON("data/allclubs.json", function(jsondata) {
		jsondata[ts]['boothmap'].forEach( function(bm){
			console.log(bm)
			var jdata = jsondata[bm.name]
			var infowindow = new google.maps.InfoWindow({
				content: "<h3><a href='#'>"+jdata.chinese+"</a></h3>" + 
					"<p> Yang Taichi Club </p>"
			});

			var clubicon = {
			  url: "img/clublogo/"+jdata.logo[0].src,
			  scaledSize: new google.maps.Size(25,25), // scaled size
			};

			var marker = new google.maps.Marker({
				position: {lat:bm.lat,lng:bm.lng},
				map: self.map,
				title: 'hi',
				icon: clubicon
			});
			marker.addListener('click', function() {
				infowindow.open(this.map, marker);
			});
		})
	})
	}
})

var navbar = new Vue({
	el : "#navbar",
	data :{
		club : '社團',
		clubs: [],
		clubhtml: false,
		navbar_fix: "",
		search: 1, // never match 1
		title: "123",
		
		nav_bar : [{
			name: '攤位',
			url: "app=location"
		},{
			name: '表演節目',
			url: "app=showtime"
		},{ 
			name: '課表',
			url: "app=course" 
		}],
	},

	methods: {
		urlGo: function(text){
			urlGo(text)
		},
		navbarUpdate : function(){
			var scroll = document.documentElement.scrollTop || document.body.scrollTop
			var navbar_top = document.getElementById("LOGO").offsetHeight
			this.navbar_fix= scroll >= navbar_top ? "navbar-fixed-top" : ""

			$("body").css("padding-top",scroll >= navbar_top ? "70px":"0")
		}
	},
	created: function(){ // readjson
		var clubs = this.clubs
		$.getJSON("data/allclubs.json", function(json) {
			jsondata = json
			jsondata[ts].clubs.forEach(function(club){
				clubs.push({
					name: jsondata[club].chinese,
					url : club
				})
			})
		});
//		$(".title-word").html(this.title)
	},
	ready: function(){
		document.addEventListener('scroll',this.navbarUpdate)
	},
	destroyed: function(){
		document.removeEventListener('scroll',this.navbarUpdate)
	}
})


var paramGet = function(text){
	if(text[0]!='?')
		throw ("lack ?")
	var text = text.slice(1,text.length)
	var arr = text.split('&')
	var dict ={}
	for(var a in arr){
		qa = arr[a].split('=')
		if(qa.length>2)
			throw ("length != 2")
		else if(qa.length==1)
			dict[decodeURIComponent(qa[0])] = true
		else
			dict[decodeURIComponent(qa[0])] = decodeURIComponent(qa[1])
	}
	return dict
}
</script>
</html>
