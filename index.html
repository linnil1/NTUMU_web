<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="js/jquery-3.1.0.min.js"></script>
	<script src="js/vue.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="css/bootstrap.css"></link>
	<link rel="stylesheet" href="css/markdown.css"></link>
	<link rel="stylesheet" href="css/mynavbar.css"></link>
	<title class="title-word">title</title>
</head>
<body>
	<div id="LOGO" class="logo">
		<img src="img/permanent_logo.png" height="100" alt="LOGO">
		<h1>台大武術聯盟      </h1> 
		<h2>NTU Martial Union </h2>			
	</div>

	<nav class="navbar navbar-default" id="navbar" v-bind:class="navbar_fix">
		<div class="container-fluid">
			<div class="navbar-header">
				<button id="sidebar_collapse_btn" class="navbar-toggle collapsed" d data-toggle="collapse" data-target="#sidebar_id" v-if="clubhtml">導覽</button>
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-collapse" aria-expanded="false">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a href="">
					<img src="img/105_1_logo.png"  height="50" alt="logo">
				</a>
				<h3 class="navbar-text mobile-hide title-word">title</h3>
			</div>
			<div class="collapse navbar-collapse" id="nav-collapse">
				<ul class="nav navbar-nav"  >
					<li v-for="nav in nav_bar">
						<a href="#" v-on:click="urlGo(nav.url)">{{nav.name}}</a>
					</li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="100" data-close-others="false">
							{{club}}<b class="caret"></b>
						</a>
						<ul class="dropdown-menu grid">
							<li v-for="club in clubs">
								<a href="#" v-on:click="urlGo(club.url)">{{club.name}}</a>
							</li>
							<!-- <li class="divider"></li>-->
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<!--navbar end-->

	<div id="main"></div>
	
	<footer class="footer">
      <div class="container">
        <p >Author : linnil1 (楊氏廣法太極拳社)</p>
        <p >Email : linnil1.886@gmail.com</p>
		<p >Tool : <a href="http://vuejs.org/" target="_blank">Vuejs</a>, <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a> </p>
      </div>
    </footer>

</body>

	<script>

var jsondata = {},
	clubname = "",
	ts = "105_1",
	appvue = null

var vueDestroy = function(){
	//$('#main').empty()
	if(appvue != null)
	{
		appvue.$destroy(true)
		console.log("destroy")
	}
	appvue = null
}

var vueBuildClub = function(c){
	clubname = c
	$('#main').append(club_html)
	appvue = new Vue(club_vue)
}

var vueBuild= function(text){
	if( text == "course" )
	{
		$('#main').append(course_html)
		console.log("created")
		appvue = new Vue(course_vue)
	}
}



var navbar = new Vue({
	el : "#navbar",
	data :{
		club : '社團',
		clubs: [],
		clubhtml: false,
		navbar_fix: "",
		href : "",
		title: "台大武術聯盟",
		
		nav_bar : [{
			name: '攤位',
			url: "app=location"
		},{
			name: '表演節目',
			url: "app=showtime"
		},{ 
			name: '課表',
			url: "app=course" 
		}],
	},

	methods: {
		urlGo : function(text){
			//window.history.pushState('', '', '/~b04611017/?'+text);  // for ntu
			window.history.pushState('', '', '/?'+text);  // for ntu
			console.log("go to "+window.location.href)

			var parser = document.createElement('a')
			parser.href = window.location.href
			try{
				var found = false
				var dict = paramGet(parser.search)
				console.log(dict)

				this.clubhtml = false
				for(var c in dict){
					if(jsondata[ts].clubs.indexOf(c)!=-1 && dict[c] == true){
						vueDestroy()
						vueBuildClub(c)
						this.clubhtml = true
						found = true
						break;
					}
				}
				if(!found && 'app' in dict){
					if(dict.app == "course"){
						vueDestroy()
						vueBuild('course')
						found = true
					}
				}

				if( found == false)
					throw ("not found")
			}
			catch(err){
				console.log(err)
				vueDestroy()
				console.log("not found")
			}
		},
		navbarUpdate : function(){
			var scroll = document.documentElement.scrollTop || document.body.scrollTop
			var navbar_top = document.getElementById("LOGO").offsetHeight
			this.navbar_fix= scroll >= navbar_top ? "navbar-fixed-top" : ""

			$("body").css("padding-top",scroll >= navbar_top ? "70px":"0")
		}
	},
	created: function(){ // readjson
		var clubs = this.clubs
		var urlgo = this.urlGo
		$.getJSON("data/allclubs.json", function(json) {
			jsondata = json
			jsondata[ts].clubs.forEach(function(club){
				clubs.push({
					name: jsondata[club].chinese,
					url : club
				})
			})
			var parser = document.createElement('a')
			parser.href = window.location.href
			if(parser.search.length)
				urlgo(parser.search.slice(1))
			else
				urlgo("")
		});
		$(".title-word").html(this.title)
		document.addEventListener('scroll',this.navbarUpdate)

	},
	destroyed: function(){
		document.removeEventListener('scroll',this.navbarUpdate)
	}
})


var paramGet = function(text){
	if(text[0]!='?')
		throw "lack ?"
	var text = text.slice(1,text.length)
	var arr = text.split('&')
	var dict ={}
	for(var a in arr){
		qa = arr[a].split('=')
		if(qa.length>2)
			throw "length != 2"
		else if(qa.length==1)
			dict[decodeURIComponent(qa[0])] = true
		else
			dict[decodeURIComponent(qa[0])] = decodeURIComponent(qa[1])
	}
	return dict
}

// share function

var weeknames = ['星期日','星期一', '星期二', '星期三', '星期四', '星期五', '星期六']

weekGet = function(weekstr){
	return weeknames.indexOf(weekstr.trim())
}
intervalGet = function(twotimes,timepx){
	var arr =  twotimes.split('~')
	var start = pxGet(arr[0],timepx)
	if(arr.length==1)
		arr.push("22:00")
	var end   = pxGet(arr[1],timepx)
	return {
		top: start+"px",
		height: end-start+"px"
	}
}

pxGet = function(yourtime,timepx){
	var arr = yourtime.split(':')
	var hour = arr[0]|0
	var mins = arr[1]|0
	return (hour*60+mins-360)*timepx/60
}

pxRemove = function(text){
	return text.slice(0,-2)|0
}

	</script>
<script src="data/all.js"></script>

</html>
